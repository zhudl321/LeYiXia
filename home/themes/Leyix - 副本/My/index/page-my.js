/**
 * SWFUpload: http://www.swfupload.org, http://swfupload.googlecode.com
 *
 * mmSWFUpload 1.0: Flash upload dialog - http://profandesign.se/swfupload/,  http://www.vinterwebb.se/
 *
 * SWFUpload is (c) 2006-2007 Lars Huring, Olov Nilz�n and Mammon Media and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * SWFUpload 2 is (c) 2007-2008 Jake Roberts and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */

require(["./common"],function(e){require(["app/page-my"])}),define("../page-my",function(){}),define("app/bind",["require","jquery"],function(e){var t=e("jquery");return function(e){e.bind("click",function(){openObj&&openObj.close();var e=t(this).attr("href"),n=t(window).width(),r=t(window).height(),i=754,s=559,o=(n-i)/2-20,u=(r-s)/2-20,a="width="+i+", height="+s+", top="+u+", left="+o+", alwaysRaised=yes, depended=yes, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";return openObj=window.open(e,"newwindow",a),!1})}}),define("app/dialog",["jquery","lib"],function(e,t){function s(t){var n="",s={},o="";t===undefined?(n="",o="",s=function(){}):typeof t=="object"?(n=t.type||"",o=t.text||"",s=t.c||function(){}):typeof t=="string"&&(n=t,s=function(){});var u=r.initPopValue().hD,a=r.initPopValue().wD;r.fullScreen(u,a),n!==""?n==="intro"?(e("body").append(e('<div class="dialog dialog-'+n+'" id="dialog">'+'<div class="version-intro">'+'<a href="javascript:;" class="version-intro-close" id="dialog-msg-close">&nbsp;&nbsp;</a>'+'<div class="version-img"></div>'+"</div>"+"</div>")),r.position(765,455)):n==="report"?e("body").append(e('<div class="dialog dialog-'+n+'" id="dialog"><div id="dialogBox'+n+'">'+i.dialogReport+"</div></div>")):n==="talk"?(e("body").append(e('<div class="dialog dialog-'+n+'" id="dialog">'+i.dialogTalk+"</div>")),typeof t=="object"&&t.label!==undefined&&(e("#labelTxt").val(t.label),e("#add-hot-labels").remove())):n==="alert"?e("body").append(e('<div class="dialog dialog-msg" id="dialog"><div id="tipTitle" class="dialog-msg-title clearfix"><h2 id="titleTxt" class="h2 fl">哈哈提示</h2><a href="javascript:;" class="dialog-msg-close fr" id="dialog-msg-close"></a></div><div  class="dialog-msg-content"><p class="mb-10">'+o+"</p>"+'<a href="javascript:;" class="btn-primary inline-block submit" id="btn-confirm">确定</a>'+"</div>"+"</div>")):n==="prompt"?e("body").append(e('<div class="dialog dialog-msg" id="dialog"><div id="tipTitle" class="dialog-msg-title clearfix"><h2 id="titleTxt" class="h2 fl">哈哈提示</h2><a href="javascript:;" class="dialog-msg-close fr" id="dialog-msg-close"></a></div><div  class="dialog-msg-content"><p class="mb-10">'+o+"</p>"+'<a href="javascript:;" '+'id="btn-confirm" class="btn-primary inline-block submit">确定</a>'+'<a href="javascript:;" id="dialog-cancle" class="btn-disabled inline-block cancel">取消</a>'+"</div>"+"</div>")):n==="msg"&&e("body").append(e('<div class="dialog dialog-msg" id="dialog"><div id="tipTitle" class="dialog-msg-title clearfix"><h2 id="titleTxt" class="h2 fl">哈哈提示</h2><a href="javascript:;" class="dialog-msg-close fr" id="dialog-msg-close"></a></div><div  class="dialog-msg-content"><p class="mb-10">'+o+"</p>"+"</div>"+"</div>")):e("body").append(e('<div class="dialog dialog-msg" id="dialog"></div>')),r.position(e("#dialog").width(),e("#dialog").height()),e("#dialog-msg-close").bind("click",function(){r.close(),s()}),e("#btnCancel").bind("click",function(){r.close()}),e("#dialog-cancle").bind("click",function(){r.close()}),e("#btn-confirm").bind("click",function(){r.close(),s()})}var n=t,r={},i={dialogReport:'<div class="dialog-msg-title clearfix"><img  class="fl "src="http://static.haha.mx/images/img-report.png" width="245" height="24" /><a href="###" class="dialog-msg-close fr" id="dialog-msg-close"></a></div><div class="dialog-msg-content"><form action="" method="get"><p class="choose-report-style" id="choose-report-style"><label> <input type="radio" name="report-style" value="这是个广告！" id="report-style-1"  checked="checked"/>这是个广告！</label><label><input type="radio" name="report-style" value="看过100遍啦~" id="report-style-2" />看过100遍啦~</label><label> <input type="radio" name="report-style" value="极度不河蟹：" id="report-style-3" />极度不河蟹：</label><label> <input type="radio" name="report-style" value="其他原因" id="report-style-4"/>其他原因</label></p><div class="iuput-box" style="display:none;" id="input-box-report" ><textarea name="iuput-box-text" cols="" rows="" class="iuput-box-text" id="reporttextArea">请举报相应信息</textarea></div><p class="clearfix"><span class="dialog-msg-error fr" id="dialog-reporttip"></span><a href="javascript:;" class="fl btn-primary submit">提交</a><a href="javascript:;" class="fl btn-disabled cancel" id="btnCancel">取消</a></p></form></div><div class="bar align-left"><p><span class="highlight">备注：</span>如果您在哈哈.MX中发现有色情、暴力或者其它违规的内容,请提交上述表格，我们将尽快处理。您的隐私会得到严格的保护。</p></div>',dialogTalk:'<div class="pb-10 clearfix"><span class="font-18 fl">来，讲一个！</span><div class="dialog-msg-error fl" id="submit-joke-error"></div><a href="###" class="dialog-msg-close fr" id="dialog-msg-close"></a></div><div class="clearfix"><div id="preview-box" class="preview-box" style="display:none;"></div><div class="iuput-box"><textarea name="iuput-box-text" cols="" rows="" class="iuput-box-text" placeholder="分享你的笑话" id="talktextArea"></textarea></div></div><div class="clearfix pb-10"><span class="add-pic-panel fl" id="add-pic-panel"><span id="btn-upload-file"></span></span><a href="#" class="add-website-file" id="add-website-file">网络图片</a><div class="add-website-file-layer" id="add-website-file-layer"><div class="triangle"><div class="triangle-border tb-background"></div><div class="triangle-border tb-border"></div></div><form><label for="file-url">请粘贴图片地址</label><span class="dialog-msg-error" id="file-url-error"></span><input type="text" id="file-url" value="http://"/><a href="#" class="btn-primary inline-block mr-10" id="btn-file-url-confirm">确定</a><a href="#" class="btn-disabled inline-block" id="btn-file-url-cancel">取消</a></form></div><a class="fr font-12" style="line-height: 18px;" href="http://extension.maxthon.cn/detail/index.php?view_id=1994&category_id=17" target="_blank">使用“哈哈分享”插件，快速发布笑话</a></div><div class="clearfix pt-10 pos-re"><div class="label-txt" id="labelTxt"><input name="label" type="text" id="label-user-input" class="label-user-input" value="添加标签"/><input type="hidden" id="ajax-label" value=""/></div><a href="###" class="label-help" id="label-help"></a><div class="label-help-layer" id="label-help-layer"><p>输入标签，让更多的人看到你的笑话。空格隔开，最多3个。</p></div></div><div class="pre-labels" id="add-hot-labels"></div><div class="pt-20"><a href="###" class="btn-primary inline-block submit" id="submit-insert-joke">发布</a> <span><input name="anonymous" type="checkbox" id="user-style" class="user-styleuser-styleuser-styleuser-style" value="1" /><label for="user-style">匿名</label></span></div>'};return r={init:function(e){n.$("dialog")===null?s(e):(r.close(),s(e))},initPopValue:function(){var t=e(document).height(),n=Math.min(e(document).width(),e("body").width()),r=e(window).height(),i=e(window).width(),s=e(window).scrollTop(),o=e(window).scrollLeft();return{hD:t,wD:n,hW:r,wW:i,tS:s,lS:o}},position:function(){var t=r.initPopValue().hD,i=r.initPopValue().wD,s=0,o=0,u=[];typeof arguments[0]=="number"?(s=arguments[0],o=arguments[1],u=e("#dialog")):(s=arguments[0].width(),o=arguments[0].height(),u=arguments[0]),r.GetValue(u,s,o);if(u.hasClass("login")&&n.checkBrowserVersion().v.indexOf("IE: 6.0")!==-1)return!1;e(window).bind("scroll",function(){r.GetValue(u,s,o)}).bind("resize",function(){r.GetValue(u,s,o)})},close:function(){var t=["dialog","overlayer"],i=0,s,o,u;while(s=t[i++])o=n.$(s),u=o&&o.parentNode,u&&u.removeChild(o);e(window).unbind("scroll",r.GetValue),e(window).unbind("resize",r.GetValue)},fullScreen:function(t,i){e("body").append('<div class="overlayer" id="overlayer"></div>'),n.checkBrowserVersion().v.indexOf("IE: 6.0")!==-1?(e("#overlayer").css({position:"absolute",height:t,width:i}),r.AddIframe(e("#overlayer"),t,i)):e("#overlayer").css({position:"fixed",height:"100%",width:"100%"})},AddIframe:function(e,t,n){e.append("<iframe></iframe>");var r=e.children("iframe");r.css({position:"absolute",top:0,left:0,opacity:0,"z-index":-1,height:t,width:n,border:0})},GetValue:function(t,i,s){var o="",u="",a="",f=r.initPopValue().wW,l=r.initPopValue().hW,c=r.initPopValue().lS,h=r.initPopValue().tS;if(t.css("display")==="none")return;n.checkBrowserVersion().v.indexOf("IE: 6.0")!==-1?(u=(f-i)/2+c,e(".dialog-msg").hasClass("login")?a=130:a=(l-s)/2+h,o="absolute"):(u=parseInt((f-i)/2),a=parseInt((l-s)/2),o="fixed"),t.css({position:o,top:a+"px",left:u+"px",width:i+"px",height:s+"px"});if(n.checkBrowserVersion().v.indexOf("IE: 6.0")!==-1){if(t.hasClass("login"))return;r.AddIframe(t,s,i)}}},r}),define("app/login",["require","jquery","./bind","./dialog"],function(e){function o(e){return document.getElementById(e)}function u(e){var n=o("login-iframe"),u=o("loginTip");if(!n||!!window.opera)return!1;var a=n.contentWindow,f=n.Document,l,c;if(a){l=a.document.body.clientHeight;if(!l)return!1;n.height=l,c=a.document.getElementById("regist")}else if(f){l=f.body.clientHeight;if(!l)return!1;n.height=l,c=f.getElementById("regist")}t("#login").css({height:parseInt(n.height)+100+"px"}),r.position(t("#login")),t("#login").css({visibility:"visible"}),t("#login-iframe").css({visibility:"visible"}),r.fullScreen(i,s);if(!c)return!1;c.onclick=function(){u.innerHTML="注册傲游帐户"}}function a(){var e=["login","overlayer"],n=0,i,s,u;while(i=e[n++])s=o(i),u=s&&s.parentNode,u&&u.removeChild(s);t(window).unbind("scroll",r.GetValue),t(window).unbind("resize",r.GetValue)}function f(e){var n="",r=e.type,i={login:{url:"http://login.haha.mx/mini/login.html?",title:"登录傲游账户"},regist:{url:"http://login.haha.mx/mini/reg.html?",title:"注册傲游帐户"}},s="",a="";if(!e.callback)return!1;e.type==="login"?(a=i.login.title,s=i.login.url+"c="+e.callback+"&sid=haha&t=unify-haha&ln=zh-cn"):e.type==="regist"&&(a=i.regist.title,s=i.regist.url+"c="+e.callback+"&sid=haha&t=unify-haha&ln=zh-cn"),n='<div class="dialog-msg login" name="login" id="login" eventId="'+r+'">'+'<div class="dialog-msg-title clearfix" id="title">'+'<h2 class="h2 fl" id="loginTip">'+a+"</h2>"+'<a class="dialog-msg-close fr" id="closeBtn" href="#"></a>'+"</div>"+'<iframe src="'+s+'" scrolling="no" frameBorder="0" marginheight="0" '+'marginwidth="0" id="login-iframe" name="login-iframe" width="100%" allowtransparency="yes" height="">'+"</iframe>"+'<dl class="clearfix" id="bind-weibo"><dt class="fl">微博登录：</dt>'+'<dd class="fl">'+'<a href="http://www.haha.mx/oauth_api.php?o=sina" target="_blank" class="inline-block sina">新浪微博</a>'+'<a href="http://www.haha.mx/oauth_api.php?o=qq" target="_blank" class="inline-block">腾讯微博</a></dd>'+"</dl>"+"</div>",t("body").prepend(t(n)),document.all?o("login-iframe").onreadystatechange=function(){o("login-iframe").readyState=="complete"&&u(e)}:o("login-iframe").onload=function(){u(e)},l()}function l(){t("#bind-weibo").find("a").each(function(e,r){n(t(r))}),t("#closeBtn").bind("click",function(){return a(),!1})}var t=e("jquery"),n=e("./bind"),r=e("./dialog"),i=r.initPopValue().hD,s=r.initPopValue().wD;return function(e){o("login")===null?f(e):(t("#login").remove(),f(e))}}),define("app/sso",["require","jquery","cookie"],function(e){var t=e("jquery"),n=e("cookie"),r=n.get("MAXAUTH");return function(){t.getScript("http://sso.maxthon.cn/get_user_cookie.php?"+Math.random(),function(){if(user_cookie_data===undefined)return!1;if(user_cookie_data.cookie===null)return!1;n.set("MAXAUTH",user_cookie_data.cookie,1);if(user_cookie_data.cookie===r)return!1;location.reload()})}}),define("app/search",["jquery","lib"],function(e,t){function i(){n.initInput(e("#key"),r,"keywords"),e("#search").bind("submit",function(){return s()})}function s(){var t=e("#key").val();t.indexOf("/")>-1&&e("#key").attr("value",t.replace(new RegExp("/","g")," "));if(t===r||t===""||e("#key").val()===" ")return!1}var n=t,r="寻找你的哈哈";return{init:i,submit:s}}),define("app/scroll",["jquery","lib"],function(e,t){function u(){location.href.indexOf("haha.mx/joke/")>0&&o!==undefined?e("body").append(e('<div class="topcontrol" id="topcontrol"><a href="'+o+'" class="go-next-joke" title="下一条">下一条</a><a href="#top" id="go-top" class="go-top" title="回到顶部"></a></div>')):e("body").append(e('<div class="topcontrol" id="topcontrol"><a href="#top" id="go-top" class="go-top" title="回到顶部"></a></div>'))}var e=require("jquery"),t=require("lib"),n=e(window).height(),r=t.checkBrowserVersion().v.indexOf("IE: 6.0")!==-1,i="",s="",o=e(".nav-joke-next").find("a:first").attr("href");(function(){t.$("topcontrol")===null&&(u(),e("#go-top").on("click",function(n){e("html, body").animate({scrollTop:0},1e3),t.statistics({n:"toTop",dt:"ui",data:{ux:"click"}})})),e(window).on("scroll resize",function(o){i=t.getBodyScrollLeft(),i>0?s=e("#content").offset().left+e("#content").width()+48-i:s=e("#content").offset().left+e("#content").width()+48,e("#topcontrol").css({position:r?"absolute":"fixed",left:s+"px",bottom:r?"auto":"0",cursor:"pointer"}),e(window).scrollTop()<n||e(window).scrollTop()===e("body").height()?e("#topcontrol").hide():e("#topcontrol").show()})})()}),define("app/dropdown",["require","jquery","cookie"],function(e){function s(){t.ajax({type:"POST",url:"/front_api.php?r=get_notice",dataType:"json",data:{},cache:!1,setTimeout:3e3,beforeSend:function(){},error:function(){},success:function(e){if(typeof e=="object"&&e!==null){for(var n in e)i+=parseInt(e[n]),e.m&&t("#my-message").html(e.m),e.c&&t("#my-comment").html(parseInt(e.c));t("#message-hint").html(i).show(),i=0}else t("#message-hint").html("").hide(),t("#my-comment").html(""),t("#my-message").html("")}})}function o(){t.getScript("http://sso.maxthon.cn/login_out.php?"+Math.random(),function(){n.set("MAXAUTH","",1),location.reload()})}var t=e("jquery"),n=e("cookie"),r=0,i=0;(function(){s(),setInterval(function(){s()},6e4),t("#nickname").on({mouseenter:function(e){clearTimeout(r),t(".account-dropdown").show().css({top:"30px",left:t(this).offset().left+t("#nickname").width()+12-t(".account-dropdown").width()+"px"})},mouseleave:function(e){r=setTimeout(function(){t(".account-dropdown").hide()},1e3)}}),t(".account-dropdown").on({mouseenter:function(e){clearTimeout(r),t(this).show()},mouseleave:function(e){t(this).hide()}}),t("#loginout").on("click",function(e){o()})})()}),define("app/nav",["jquery"],function(e){function n(n){n=n||{};var r=n.t,i=n.o,s=t[r],o="";e("#ext-tab").length>0?r==="hot"?o="/"+e("#ext-tab").find("li.current").attr("type"):o="":o="";var u='<div class="nav-dropdown" id="nav-dropdown-'+r+'">'+"<p>"+'<a href="/'+r+"/day"+o+'">24小时最'+s+"</a>"+"</p>"+"<p>"+'<a href="/'+r+"/week"+o+'">1周内最'+s+"</a>"+"</p>"+"<p>"+'<a href="/'+r+"/month"+o+'">1月内最'+s+"</a>"+"</p>"+"<p>"+'<a href="/'+r+"/year"+o+'">1年内最'+s+"</a>"+"</p>"+"<p>"+'<a href="/'+r+"/history"+o+'">历史最'+s+"</a>"+"</p>"+"</div>";e("#nav-dropdown-"+r).length===0?i.append(u):e("#nav-dropdown-"+r).show()}function r(){e("#navigation").find("li[data]").each(function(t,r){var i=e(r).attr("data"),s="";e(r).attr("class")?s=e(r).attr("class"):s="",e(r).bind("mouseover",function(){n({t:i,o:e(this)}),e("#nav-dropdown-"+i).css({top:e(r).offset().top+37+"px",left:e(r).offset().left+"px"}),e(this).removeClass(s).addClass("hover")}),e(r).bind("mouseout",function(){e("#nav-dropdown-"+i).is(":visible")&&(e("#nav-dropdown-"+i).hide(),e(this).removeClass("hover").addClass(s))})})}var t={good:"哈",hot:"热"};return{init:r}});var SWFUpload;SWFUpload==undefined&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings=e,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){if(typeof e!="string"||e.match(/^https?:\/\//i)||e.match(/^\//))return e;var t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),n=window.location.pathname.lastIndexOf("/");return n<=0?path="/":path=window.location.pathname.substr(0,n)+"/",path+e},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,t){this.settings[e]=this.settings[e]==undefined?t:this.settings[e]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,!this.settings.prevent_swf_caching||(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(document.getElementById(this.movieName)!==null)throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(e==undefined)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;t=document.createElement("div"),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),window[this.movieName]==undefined&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){this.movieElement==undefined&&(this.movieElement=document.getElementById(this.movieName));if(this.movieElement===null)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if(typeof e=="object")for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()));return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var e=null;e=this.getMovieElement();if(e&&typeof e.CallFunction=="unknown"){for(var t in e)try{typeof e[t]=="function"&&(e[t]=null)}catch(n){}try{e.parentNode.removeChild(e)}catch(r){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(i){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler=="function").toString(),"\n","	","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler=="function").toString(),"\n","	","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler=="function").toString(),"\n","	","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler=="function").toString(),"\n","	","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler=="function").toString(),"\n","	","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler=="function").toString(),"\n","	","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler=="function").toString(),"\n","	","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler=="function").toString(),"\n","	","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler=="function").toString(),"\n","	","debug_handler assigned:             ",(typeof this.settings.debug_handler=="function").toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,n){return t==undefined?this.settings[e]=n:this.settings[e]=t},SWFUpload.prototype.getSetting=function(e){return this.settings[e]!=undefined?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return returnValue!=undefined&&typeof returnValue.post=="object"&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return typeof e=="number"?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){typeof e=="string"&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){e==undefined&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var n=this.getMovieElement();n!=undefined&&(n.style.width=e+"px",n.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){t==undefined?t=[]:t instanceof Array||(t=[t]);var n=this;if(typeof this.settings[e]=="function")this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){n.executeNextEvent()},0);else if(this.settings[e]!==null)throw"Event handler "+e+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;typeof e=="function"&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t=/[$]([0-9a-f]{4})/i,n={},r;if(e!=undefined){for(var i in e.post)if(e.post.hasOwnProperty(i)){r=i;var s;while((s=t.exec(r))!==null)r=r.replace(s[0],String.fromCharCode(parseInt("0x"+s[1],16)));n[r]=e.post[i]}e.post=n}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(e),this.queueEvent("swfupload_loaded_handler")},SWFUpload.prototype.cleanUp=function(e){try{if(this.movieElement&&typeof e.CallFunction=="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e)try{typeof e[t]=="function"&&(e[t]=null)}catch(n){}}}catch(r){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(n){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,n])},SWFUpload.prototype.fileDialogComplete=function(e,t,n){this.queueEvent("file_dialog_complete_handler",[e,t,n])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if(typeof this.settings.upload_start_handler=="function")e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e);else if(this.settings.upload_start_handler!=undefined)throw"upload_start_handler must be a function";t===undefined&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,n])},SWFUpload.prototype.uploadError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,n])},SWFUpload.prototype.uploadSuccess=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,n])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,n=[];if(typeof e=="object"&&typeof e.name=="string"&&typeof e.message=="string"){for(var r in e)e.hasOwnProperty(r)&&n.push(r+": "+e[r]);t=n.join("\n")||"",n=t.split("\n"),t="EXCEPTION: "+n.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,n;try{t=document.getElementById("SWFUpload_Console"),t||(n=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(n),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",n.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(r){alert("Exception: "+r.name+" Message: "+r.message)}},define("swfupload",function(){}),define("app/talk",["jquery","lib","./login","./dialog","swfupload"],function(e,t,n,r,i){function p(){return u=new SWFUpload({flash_url:"/Public/images/swfupload.swf",upload_url:"/front_api.php",post_params:{PHPSESSID:"",r:"upload_image"},file_size_limit:"2048 KB",file_types:"*.gif;*.jpg;*.png",file_types_description:"Images Files",file_upload_limit:100,file_queue_limit:1,custom_settings:{autoStart:!1},debug:!1,button_image_url:"/Public/images/btn-upload-file.png",button_placeholder_id:"btn-upload-file",button_width:"78",button_height:"18",button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,swfupload_loaded_handler:function(){},file_dialog_start_handler:function(){},file_queued_handler:function(e){},file_queue_error_handler:function(e,t,n){try{switch(t){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:alert(s["IMG-NUMBER-EXCESS"]);break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:alert(s["IMG-BYTE-EXCESS"]);break;default:e!==null&&alert(s["IMG-SEND-ERROR"])}}catch(r){this.debug(r)}},file_dialog_complete_handler:function(e,t,n){u.startUpload()},upload_start_handler:function(e){y()},upload_progress_handler:function(e,t,n){},upload_error_handler:function(e,t,n){try{switch(t){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:break;default:w()}}catch(r){this.debug(r)}},upload_success_handler:function(e,n){try{b(e,n),t.statistics({m:"head",n:"makeJoke",o:"locImage",dt:"ui",data:{ux:"click"}})}catch(r){this.debug(r)}},upload_complete_handler:function(e){}}),u}function d(){var n=/^http:\/\/(www\.)?([0-9a-zA-Z]{1,}\.)+[a-z]{2,6}\/([\w\-\@?^=%&amp;/~\+#]{1,}\/)*[0-9a-zA-Z\-_]+\.(jpg|png|gif)$/g,r=e.trim(e("#file-url").val());return r===""?(t.showMsg(e("#file-url-error"),"网址不能为空"),!1):n.test(r)?!0:(t.showMsg(e("#file-url-error"),"网络格式错误"),!1)}function v(n,r){e.ajax({url:"/front_api.php?r=upload_image_joke",type:"GET",data:{image_url:r},dataType:"json",cache:!1,beforeSend:function(){n.removeClass("btn-primary").addClass("btn-disabled"),y()},error:function(){w(),n.removeClass("btn-disabled").addClass("btn-primary"),alert("图片抓取错误，请重试或存到本地后上传")},success:function(e){n.removeClass("btn-disabled").addClass("btn-primary"),m(e)},complete:function(){t.statistics({m:"head",n:"makeJoke",o:"webImage",dt:"ui",data:{ux:"click"}})}})}function m(e){var t=0,n="";typeof e=="object"&&(t=e.code,n=e.filename,t===1&&n!==""?b("",n):(w(),t===2?alert("类型不符合"):t===3?alert("图片不能为空"):t===0?alert("您发表的图片超过限定大小"):alert("图片抓取错误，请重试或存到本地后上传")))}function g(){e("#add-website-file-layer").is(":visible")&&e("#add-website-file-layer").hide().find("#file-url").val("http://")}function y(){g(),e("#submit-insert-joke").removeClass("btn-primary").addClass("btn-disabled"),e("#preview-box").show().addClass("preview-box-loading"),e("#talktextArea").val()!==s["JOKE-DEFAULT"]?e("#talktextArea").css({width:"457px"}).parent().css({"float":"right"}):e("#talktextArea").css({width:"457px"}).attr("placeholder","给图片加点说明吧").val("").parent().css({"float":"right"})}function b(t,n){e("#preview-box").removeClass("preview-box-loading").html('<a href="###" class="btn-close-preview" id="btn-close-preview"><a/><img src="/upload/temp_images/'+n+'" width="108"/>'),e("#talktextArea").val()!==s["JOKE-DEFAULT"]?e("#talktextArea").css({width:"457px"}).attr("placeholder","给图片加点说明吧").parent().css({"float":"right"}):e("#talktextArea").css({width:"457px"}).attr("placeholder","给图片加点说明吧").val("").parent().css({"float":"right"}),S(),f.file_name=n,a=!0,h=!0,e("#submit-insert-joke").removeClass("btn-disabled").addClass("btn-primary")}function w(){e("#preview-box").removeClass("preview-box-loading").addClass("preview-box-error").html('<a href="###" class="btn-close-preview" id="btn-close-preview"><a/>'),e("#talktextArea").val()!==s["JOKE-DEFAULT"]?e("#talktextArea").css({width:"457px"}).attr("placeholder","给图片加点说明吧").parent().css({"float":"right"}):e("#talktextArea").css({width:"457px"}).attr("placeholder","给图片加点说明吧").val("").parent().css({"float":"right"}),S(),e("#submit-insert-joke").removeClass("btn-disabled").addClass("btn-primary")}function E(){e("#preview-box").hide().html(""),e("#talktextArea").css({width:"586px"}).attr("placeholder",s["JOKE-DEFAULT"]).parent().css({"float":"none"}),f.file_name="",a=!1,h=!1}function S(){e("#btn-close-preview").on("click",function(){E()})}function x(){var t=o.length,n="";for(var r=0;r<t;r++)n+='<a href="###" class="inline-block">'+o[r]+"</a>";e("#add-hot-labels").html(n),T()}function T(){var n=e("#add-hot-labels").find("a");e.each(n,function(n){e(this).on("click",function(){e("#labelTxt").find("span").length>2&&(t.showMsg(e("#submit-joke-error"),"最多输入3个标签"),e("#label-user-input").val("")),N(e(this).html()),k()})})}function N(n){var r=e.trim(n),i=e("#ajax-label").val(),o=[],u=[],a=0;if(r.length>5)return t.showMsg(e("#submit-joke-error"),s["LABEL-NUMBER-EXCESS"]),!1;if(i==="")e("#label-user-input").before(" <span>"+r+'<a href="###" data="'+r+'"></a></span>').focus().val(""),e("#ajax-label").val(r);else{o=e.trim(i).split(","),u=o.length;if(!(u<3))return!1;e("#label-user-input").before("<span>"+r+'<a href="###" data="'+r+'"></a></span>').focus().val(""),e("#ajax-label").val(i+","+r)}}function C(t){var n=e("#ajax-label").val(),r=e.trim(n).split(","),i=r.length,s=[];for(var o=0;o<r.length;o++)r[o]!==t&&s.push(r[o]);e("#ajax-label").val(s.join(","))}function k(){e("#labelTxt").find("span > a").each(function(t,n){e(n).on("click",function(t){C(e(this).attr("data")),e(this).parent().remove(),e("#label-user-input").focus()})})}function L(){var n="";e("#label-user-input").on("keydown",function(r){n=e.trim(e(this).val());if(r.keyCode===32&&n!==""){if(r.ctrlKey||r.altlKey||r.shiftKey)return!1;N(n),k()}n===""&&r.keyCode===8&&(C(e("#labelTxt").find("span:last > a").attr("data")),e("#labelTxt").find("span:last").remove()),e("#labelTxt").find("span").length>2&&t.showMsg(e("#submit-joke-error"),"最多输入3个标签")})}function A(){var n=e("#ajax-label").val(),r=n.split(","),i=0,o=r.length,u=0;if(o>3)t.showMsg(e("#submit-joke-error"),s["LABEL-DEFAULT"]);else{for(var a=0;a<o;a++){u=r[a].length;if(u>5&&r[a]!==s["LABEL-DEFAULT"]){t.showMsg(e("#submit-joke-error"),s["LABEL-NUMBER-EXCESS"]),i=1;break}}if(i===0)return r.join(" ")}}function O(){var n=e.trim(e("#talktextArea").val()),r=n.length,i=0;r>3e3?t.showMsg(e("#submit-joke-error"),s["JOKE-EXCESS"]):r===0?t.showMsg(e("#submit-joke-error"),s["JOKE-NULL"]):n!==s["JOKE-DEFAULT"]?(i=A(),A()!==""?f.joke_label=i.replace(new RegExp("趣图","g"),""):f.joke_label="",f.joke_content=n,f.anonymous=e("input[name='anonymous']").is(":checked"),D(f)):t.showMsg(e("#submit-joke-error"),s["JOKE-NULL"])}function M(t,n,r){var i=A();r?(i===""?f.joke_label="":f.joke_label=i.replace(new RegExp("趣图","g"),""),f.joke_content="",f.anonymous=e("input[name='anonymous']").is(":checked"),D(f)):t?(f.file_name="",O()):n&&O()}function _(){var t=e.trim(e("#talktextArea").val()),n=!1,r=!1,i=!1,o=0,u="";location.href.indexOf("haha.mx/share")>-1?(f.appid=e("#talktextArea").attr("appid"),f.refer=e("#talktextArea").attr("refer"),e("#preview-box").length>0&&e("#preview-box").is(":visible")?(e("#preview-box").find("img").attr("src").match(/^\/upload\/temp_images\//g)===null?u=e("#preview-box").find("img").attr("src"):u=e("#preview-box").find("img").attr("src").replace(/^\/upload\/temp_images\//g,""),n=t===s["JOKE-DEFAULT"]||t==="给图片加点说明吧"||t==="",r=t!==s["JOKE-DEFAULT"]&&t!==""&&t!=="给图片加点说明吧",n&&(f.file_name=u,f.joke_content=""),r&&(f.file_name=u,f.joke_content=t)):(i=!0,f.joke_content=t,f.file_name="")):(f.appid="",f.refer="",n=a===!0&&h===!0&&f.file_name!==""&&(t===s["JOKE-DEFAULT"]||t==="给图片加点说明吧"||t===""),i=a===!1,r=a===!0&&h===!0&&f.file_name!==""&&t!==s["JOKE-DEFAULT"]&&t!==""&&t!=="给图片加点说明吧"),M(i,r,n)}function D(n){e.ajax({type:"POST",url:"/front_api.php?r=insert_joke",data:n,dataType:"json",cache:!1,beforeSend:function(){e("#submit-insert-joke").html("发布中").removeClass("btn-primary").addClass("btn-disabled")},error:function(e){r.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"})},success:function(e){P(e)},complete:function(){e("#submit-insert-joke").html("发表").removeClass("btn-disabled").addClass("btn-primary"),t.statistics({m:"head",n:"makeJoke",o:"pushSuc",dt:"ui",data:{ux:"click"}})}})}function P(i){try{switch(i){case-1:t.showMsg(e("#submit-joke-error"),s["JOKE-SEND-FORMAT"]);break;case 1:r.init({type:"msg",text:"<img src='http://static.haha.mx/images/ajax-loader.gif' style='vertical-align:middle; margin:0 6px 0 0'/>哈哈发布成功"}),location.href="/new";break;case 0:t.showMsg(e("#submit-joke-error"),s["JOKE-SEND-ERROR"]);break;case 2:r.init({type:"alert",text:"由于发表不当言论，您的账号已被屏蔽，暂时不能发表。</br>如有问题请和管理员联系：haha@maxthon.net。"});break;case 3:t.showMsg(e("#submit-joke-error"),s["JOKE-SEND-UNLEAGAL"]);break;case 4:r.close(),n({element:"btn-talk",type:"login",callback:"logined"}),e("#login #loginTip").html("请先登录傲游账户");break;case 5:t.showMsg(e("#submit-joke-error"),s["JOKE-SEND-INTERVAL"]);break;case 7:r.init({type:"msg",text:"<img src='http://static.haha.mx/images/ajax-loader.gif' style='vertical-align:middle; margin:0 6px 0 0'/>哈哈发布中"}),location.href="/my";break;default:f={}}}catch(o){console.log(o)}}function H(n){n===undefined&&(t.initInput(e("#label-user-input"),s["LABEL-DEFAULT"],"label-user-input"),x()),e("#talktextArea").on("focus",function(t){e(this).css({color:"#333"})}),L(),e("#label-help").on({mouseenter:function(t){e("#label-help-layer").show()},mouseleave:function(t){e("#label-help-layer").hide()}}),e("#add-website-file").on("click",function(){e("#add-website-file-layer").show(),e("#btn-file-url-confirm").on("click",function(t){if(!d())return!1;v(e(this),e.trim(e("#file-url").val()))})}),e("#btn-file-url-cancel").add(e("body")).on("mouseup",function(e){g()}),e("#add-website-file-layer").on("mouseup",function(e){e.stopPropagation()}),p(),e("#submit-insert-joke").on("click",function(){t.statistics({m:"head",n:"makeJoke",o:"push",dt:"ui",data:{ux:"click"}});if(!e("#submit-insert-joke").hasClass("btn-primary"))return!1;_()}),e("#dialog-msg-close").on("click",function(){E(),f={}})}function B(t,i){t===1?(i===undefined?r.init("talk"):r.init({type:"talk",label:i}),H(i)):t===0?(n({element:"btn-talk",type:"login",callback:"logined"}),e("#login #loginTip").html("请先登录傲游账户")):t===2&&r.init({type:"alert",text:"由于发表不当言论，您的账号已被屏蔽，暂时不能发表。</br>如有问题请和管理员联系：haha@maxthon.net。"})}var s={"JOKE-DEFAULT":"分享你的笑话","JOKE-NULL":"请输入笑话正文","JOKE-SEND-FORMAT":"输入文字格式或内容不正确，发表失败！","JOKE-SEND-ERROR":"由于网络问题未发表成功，请稍后重试！","JOKE-SEND-UNLEAGAL":"文字中包含不当内容，请重新输入！","JOKE-SEND-INTERVAL":"您讲得太快啦~休息，休息一下~","JOKE-EXCESS":"您的笑话太长了~请精简在3000字以内","LABEL-NUMBER-EXCESS":"您的标签太长了~请精简在5个字以内","LABEL-DEFAULT":"添加标签","IMG-NUMBER-EXCESS":"每条笑话限制上传一张图片","IMG-BYTE-EXCESS":"您发表的图片超过限定大小","IMG-SEND-ERROR":"上传失败请稍后重试"},o=["内涵","美女","囧","冷笑话","神吐槽","恶搞","无节操","不是笑话"],u={},a=!1,f={},l=0,c=!1,h=!1;return{init:function(t){e.ajax({type:"GET",url:"/front_api.php?r=login",dataType:"json",cache:!1,error:function(e){r.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"})},success:function(e){t===undefined?B(e):B(e,t)}})},bind:H,uploadReset:E,UploadToTempDel:S}}),define("app/checkin",["require","jquery","./login","./dialog"],function(e){function o(e){t(".btn-checkin").find("span").html("+"+parseInt(e)).show().animate({opacity:.25,top:"-50"},1e3,function(){t(this).hide(),t(".btn-checkin").removeClass("active").addClass("disabled").unbind("click").html("已签到")})}var t=e("jquery"),n=e("./login"),r=e("./dialog"),i={},s=null;return function(){s=t.ajax({url:"/front_api.php?r=sign",type:"GET",data:i,dataType:"json",cache:!1}),s.done(function(e){var t=e.code;switch(t){case 1:o(e.n);break;case 0:n({type:"login",callback:"logined"});break;case 2:r.init({type:"alert",text:"您今天已经签到，明天再来吧"});break;case 3:r.init({type:"alert",text:"签到失败，请稍候再试"});break;default:return!1}}),s.fail(function(e,t){r.init({type:"alert",text:"签到失败，请稍候再试"})})}}),define("app/broadcast",["jquery","http://www.haha.mx/upload/data/broadcast.json","cookie","lib"],function(e,t,n,r){function c(){var t=a.length,n="";for(var i=0;i<t;i++)a[i].url===""?n+="<p>"+a[i].content+"</p>":n+='<a target="_blank" href="'+a[i].url+'">'+a[i].content+"</a>";l.html(n),l.find("a").each(function(t,n){e(n).on("click",function(){r.statistics({m:"head",n:"Mnews",dt:"ui",data:{ux:"click"}})})})}var i=0,s=null,o=n.get("BLTIME"),u=t.time,a=t.broadcast,f=e("#btn-broacast-list").find(".sup"),l=e("#broacast-list").find("div.broacast-item");(function(){if(typeof t!="object")return!1;o===""||o!==u?(f.html(a.length).show(),n.set("BLTIME",u)):o===u&&(f.html("").hide(),n.set("BLTIME",u)),c(),e("#btn-broacast-list").on({mouseenter:function(t){clearTimeout(i),e("#broacast-list").show(),f.html("").hide()},mouseleave:function(t){i=setTimeout(function(){e("#broacast-list").hide()},1e3)}}),e("#broacast-list").on({mouseenter:function(){clearTimeout(i),e(this).show()},mouseleave:function(){e(this).hide()}})})()}),define("app/top-bar",["require","jquery","cookie"],function(e){function a(){var e="",n=t('<div class="safe-tips" id="safe-tips"></div>');t(".header").before(n),e='<div class="clearfix"> <div class="lt"><img src="http://static.haha.mx/images/product_logo_16.png"/>'+r+'<a href="'+i+'" target="_blank">下载试用</a></div>'+"</div>",t("#safe-tips").html(e+'<a href="###" class="safe-tips-close" id="safe-tips-close"></a>'),t("#safe-tips-close").bind("click",function(){f()})}function f(){n.set("haApp",1,5184e3,"/"),t("#safe-tips").remove()}var t=require("jquery"),n=require("cookie"),r="傲游发布Mac版浏览器，打造全平台服务",i="http://www.maxthon.cn/mac/",s=navigator.userAgent,o=/Macintosh/.test(s),u=/Maxthon/.test(s);(function(){var e="";if(o&&!u){e=n.get("haApp");if(e==="")a();else if(e==="1")return!1}})()}),define("app/feedback",["jquery","lib","./dialog"],function(e,t,n){function f(){n.init(),e("#dialog").html(a).css({padding:"20px"}),n.position(600,280)}function l(){for(var t in s){var n=e.trim(e("#feedback-"+t).val());n===i||n===r?s[t]="":s[t]=n}}function c(){u>0?(e("#feedback-done").find("strong").html(u),u--,setTimeout(function(){c()},1e3)):n.close()}function h(){l();for(var n in s){if(n==="content"&&(s.content===""||s.content===r))return t.showMsg(e("#submit-joke-error"),"请输入反馈内容"),!1;if(n==="email"&&s.email!==""&&s.email!==i&&!o.test(s.email))return t.showMsg(e("#submit-joke-error"),"请输入正确的邮箱地址"),!1}s.type=1,p()}function p(){e.ajax({type:"POST",url:"/front_api.php?r=suggest",dataType:"json",data:s,cache:!1,beforeSend:function(){e("#feedback-loading").show(),e("#feedback-data").hide()},error:function(){s={content:"",email:""}},success:function(t){s={content:"",email:""},e("#feedback-loading").hide(),e("#feedback-done").show(),u=3,c()}})}var r="请在这里输入您的意见或建议，我们会认真阅读您的每份建议，并且不断改进我们的产品。",i="请填写您的邮箱地址，用于我们回复您。",s={content:"",email:""},o=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,u=3,a='<div class="pb-10 clearfix"><span class="font-18 fl">留言反馈</span><div class="dialog-msg-error fl" id="submit-joke-error"></div><a href="###" class="dialog-msg-close fr" id="dialog-msg-close"></a></div><div class="feedback-data" id="feedback-data"><div class="iuput-box"><textarea name="feedback-text" cols="" rows="" class="iuput-box-text" id="feedback-content">'+r+"</textarea>"+"</div>"+"<fieldset>"+"<legend>您的邮箱地址</legend>"+'<input type="text" name="feedback-email" id="feedback-email" class="feedback-email" value="'+i+'" />'+"</fieldset>"+'<div class="pt-20"><a href="###" class="btn-primary inline-block" id="feedback-submit">提交</a> '+'<a href="###" class="btn-disabled inline-block" id="feedback-cancel">取消</a></div>'+"</div>"+'<div class="feedback-loading" id="feedback-loading">'+'<h2 class="">正在提交</h2><span>请稍后...</span>'+"</div>"+'<div class="feedback-done" id="feedback-done">'+"<h2>提交成功，感谢您的反馈！</h2><span><strong>3</strong>秒后自动关闭</span>"+"</div>";return function(){f(),t.initInput(e("#feedback-content"),r,"iuput-box-text"),t.initInput(e("#feedback-email"),i,"feedback-email"),e("#feedback-cancel").add(e("#dialog-msg-close")).on("click",function(){n.close()}),e("#feedback-submit").on("click",function(){h()})}}),define("app/common",["require","jquery","./login","./sso","./search","./scroll","./bind","./dropdown","./nav","./talk","./checkin","lib","./broadcast","./top-bar","./feedback"],function(e){var t=e("jquery"),n=e("./login"),r=e("./sso"),i=e("./search"),s=e("./scroll"),o=e("./bind"),u=e("./dropdown"),a=e("./nav"),f=e("./talk"),l=e("./checkin"),c=e("lib"),h=e("./broadcast"),p=e("./top-bar"),d=e("./feedback");r(),c.checkHref().r==="joke"&&t(".joke-item").attr("s-d-n")==="video"?c.statistics({n:"open",o:"video",dt:"oc",data:{ux:"open"}}):c.statistics({n:"open",dt:"oc",data:{ux:"open"}}),t("#btn-add-fav").length===1&&t("#btn-add-fav").on("click",function(){c.addFav(),c.statistics({m:"head",n:"favorite",dt:"ui",data:{ux:"click"}})}),t(".btn-checkin").on("click",function(){if(t(this).hasClass("disabled"))return!1;l(),c.statistics({m:"head",n:"signed",dt:"ui",data:{ux:"click"}})}),t("#btn-login").on("click",function(){return n({element:"btn-login",type:"login",callback:"logined"}),!1}),t("#btn-regist").on("click",function(){return n({element:"btn-regist",type:"regist",callback:"logined"}),!1}),a.init(),i.init(),t("#btn-talk").on("click",function(){return f.init(),c.statistics({m:"head",n:"makeJoke",o:"make",dt:"ui",data:{ux:"click"}}),!1}),o(t("#btn-login-qq")),o(t("#btn-login-sina")),t("#add-feedback").add(t("#btn-feedback")).on("click",function(){d(),c.statistics({m:"head",n:"feedback",dt:"ui",data:{ux:"click"}})}),t(".recommend-url").length===1&&t(".recommend-url").find("a").each(function(e,n){t(n).on("click",function(){var e=t(this).html(),n=t(this).attr("href");c.statistics({n:"recommendURL",dt:"content",data:{url:n,title:e}})})}),t(".labels").length===1&&t(".labels").find("dd > a").each(function(e,n){t(n).on("click",function(){var e=t(this).html(),n=t(this).attr("href");c.statistics({n:"hotTag",dt:"content",data:{url:n,title:e}})})}),t("#btnGo").on("click",function(){var e="",n=t.trim(t("#jumpNum").val());location.pathname==="/"?e="/good/day/"+n:e=location.pathname.replace(/(\/([0-9]+))$/g,"")+"/"+n,c.statistics({n:"buttonGO",dt:"content",data:{url:e,title:"GO按钮"}})})}),define("app/face",["jquery"],function(e){function h(){if(e("#face").length=="0"){e("body").append('<div class="face" id="face"><div class="face-bg"><div class="face-warp"><ul class="face-sort" id="face-sort"></ul><ul class="face-content" id="face-content"></ul></div></div><div class="face-corner"></div></div>'),t=e("#face"),n=e("#face-sort"),r=e("#face-content");var i=[],s=[];for(var o=0;o<u.length;o++){var a="";for(var f=0;f<u[o].data.length;f++){var l=String(o)+(f<10?"0"+f:f);a+='<a title="'+u[o].data[f]+'" href="#"><img src="http://static.haha.mx/images/face/'+l+'.gif" alt="'+u[o].data[f]+'" /></a>'}s[o]='<li class="clearfix'+(o===0?" current":"")+'">'+a+"</li>",i[o]="<li"+(o===0?' class="current"':"")+'><a href="###">'+u[o].name+"</a><span></span></li>"}n.html(i.join("")),r.html(s.join(""));var c=r.find("a");c.click(function(){return v(e(this).attr("title")),!1});var h=0,p=n.find("li"),d=r.find("li");p.click(function(){var t=e(this).index();return t!=h&&(h=t,p.removeClass("current").eq(t).addClass("current"),d.removeClass("current").eq(t).addClass("current")),!1}),e("body").mouseup(function(){g()}),t.mouseup(function(e){e.stopPropagation()})}}function p(){var n=i.offset(),r=o;o==="fixed"&&(window.XMLHttpRequest?(n.top-=e(document).scrollTop(),n.left-=e(document).scrollLeft()):r="absolute"),t.css({top:n.top+23,left:n.left-3,position:r})}function d(){p(),e(window).unbind("resize",p).resize(p),o==="fixed"&&!window.XMLHttpRequest&&e(window).unbind("scroll",p).scroll(p)}function v(t){var n=s.val(),r=Number(s.attr("range")||0),i=n.substr(0,r),o=n.substr(r);s.val(i+"["+t+"]"+o),s.attr("range",r+Number(t.length)+2);var u=s.attr("id").split("-")[2];u&&e("#lwords-"+u).html(400-s.val().length)}function m(e,n,r){h(),i=e,s=n,o=r||"absolute",d(),t.show()}function g(){e(window).unbind("resize",p),!window.XMLHttpRequest&&e(window).unbind("scroll",p),t.hide()}function y(e,t){return t&&(e=e.substr(0,t).replace(/\[[^\]]*$/g,"")),e=e.replace(/\[[^\[\]]+\]/g,function(e){var t=e.replace(/[\[\]]/g,""),n=a[t];return n?'<img alt="'+t+'" title="'+t+'" src="http://static.haha.mx/images/face/'+n+'.gif">':e}),e}var t,n,r,i,s,o,u=[{name:"默认表情",data:["微笑","再见","鼓掌","摇头","哭泣","调皮","委屈","吐血","害羞","可怜","眨眼","抠鼻","亲亲","糗","擦汗","鄙视","坏笑","无语"]}],a={};for(var f=0;f<u.length;f++)for(var l=0;l<u[f].data.length;l++){var c=String(f)+(l<10?"0"+l:l);a[u[f].data[l]]=c}return{open:m,close:g,getFaceUrl:y}}),define("app/light",["require","jquery"],function(e){var t=e("jquery"),n={},r={};return function(e,i,s,o){n={cid:s,jid:i,uid:o},e.addClass("light-disabled"),r=t.ajax({type:"GET",url:"/front_api.php?r=light",dataType:"json",data:n,cache:!1}),r.done(function(t){if(t===1){var n=parseInt(e.html());e.html(n+1)}})}}),define("app/comment",["require","jquery","lib","cookie","./face","./login","./dialog","./light"],function(e){function d(){var e={},t=window.location.search.replace(/^\?/,"").split("&"),n=window.location.pathname.replace(/^\//,"").split("/");e.r=n[0],e.f=t[0];var r=n[n.length-1];return e}function v(e){var r=0,i=0,s="";e.rid=e.rid||0,r=e.jid,i=e.rid,e.replyStr!==undefined?s=encodeURI(b(r).replace(e.replyStr,"")):s=encodeURI(b(r)),t.ajax({type:"GET",url:"/front_api.php?r=insert_comment",data:{jid:r,content:s,rid:i,juid:e.juid,ruid:e.ruid},dataType:"json",cache:!1,beforeSend:function(){t("#send-"+r).removeClass("btn-primary").addClass("btn-disabled")},error:function(e){n.showMsg(r,p["CMT-SEND-ERROR"],{className:"comment-msg"})},success:function(e){m(e,r)},complete:function(){t("#send-"+r).removeClass("btn-disabled").addClass("btn-primary")}})}function m(e,r){var i=a.getOrder(r);e===1?(location.href.indexOf("haha.mx/my/comment")>0?location.reload():(a.cancelReply(r),setTimeout(function(){t("#msg-"+r).fadeOut(500)},100),S(r),a.get(r,1,i)),t("#send-"+r).attr("rid","0"),t("#send-"+r).attr("ruid","0"),t("#send-"+r).attr("reply","")):e===0?n.showMsg(r,p["CMT-SEND-ERROR"],{className:"comment-msg"}):e===2?n.showMsg(r,p["CMT-TIP-LOGIN"],{className:"comment-msg"}):e===3?n.showMsg(r,p["CMT-SEND-KEYWORD"],{className:"comment-msg"}):e===5?n.showMsg(r,p["CMT-TIP-INTERVAL"],{className:"comment-msg"}):e===6?n.showMsg(r,p["CMT-TIP-BAN"],{className:"comment-msg"}):e===7&&(location.href="/my/comment/send")}function g(e,n,i,u,a){var f=0,l="";e===1?(S(i),t("#comment-input-"+i).trigger("keyup").focus(),t("#send-"+i).attr("rid",u),t("#send-"+i).attr("ruid",a),t("#send-"+i).attr("reply","回复 "+n+": "),t("#comment-input-"+i).val("回复 "+n+": "),l="回复 "+n+": ",f=l.length,r.set("reTxt",l,365),t("#comment-input-"+i).attr("range",f),t("#lwords-"+i).html(400-parseInt(f))):e===0?s({type:"login",callback:"logined"}):e===2&&o.init({type:"alert",text:"由于发表不当言论，您的账号已被屏蔽，暂时不能发表。</br>如有问题请和管理员联系：haha@maxthon.net。"})}function y(e){var i=t.trim(t("#comment-input-"+e).val()),s=t.trim(r.get("reTxt")),o=s.length;if(d().r==="joke")return i===""||i===h?(n.showMsg(e,p["CMT-SEND-EMPTY"],{className:"comment-msg"}),!1):!0;if(i!==""&&(i!==s||i.length!==o))return!0;n.showMsg(e,p["CMT-SEND-EMPTY"],{className:"comment-msg"}),t("#comment-input-"+e).focus()}function b(e){return t("#comment-input-"+e).val()}function w(e,n){var r="",s="",o=e.length,u="",a=0;for(var f=0;f<o;f++)a=f+1,e[f].user_name===null?u=e[f].user_id:u=e[f].user_name,s+='<div class="bar quote">',r+='<div class="clearfix"><span class="fl"><strong class="nickname"> '+u+" </strong>发布于"+e[f].time+"</span>"+'<span class="fr">'+a+"</span>"+"</div>"+"<p>"+i.getFaceUrl(e[f].content)+"</p>",t("#comment-container-"+n).attr("urlFrom")===undefined&&(r+='<p class="align-right quote-btn-container"><a href="###" class="btn-replay" data="'+u+"&"+e[f].id+"&"+e[f].user_id+'">回复</a> |<!--'+'--> <a href="###" class="btn-report" data="'+e[f].id+'">举报</a> ',l===e[f].user_id?r+='| <a href="###" class="btn-del" data="'+e[f].id+'">删除</a></p>':r+="</p>"),r+="</div>";return s+r}function E(e,n,s,o,u){var f="",c=0,h="",p="",v=[],m=[],g=0,y="";u=u||"";if(typeof e=="object"){for(var b in e)e[b]===null&&(e[b]="");t("#comment-"+n).length===1&&t("#comment-"+n).html(e.count),t("#joke-"+n).find(".comment").html(e.count),t("#all-"+n).length===1&&(t("#comment-container-"+n).attr("urlFrom")==="hao123"?e.count>3?t("#all-"+n).html("后面还有"+(e.count-3)+'条评论<a href="/joke/'+n+'#ac">点击查看详细</a>'):t("#all-"+n).html("共有"+e.count+'条评论<a href="/joke/'+n+'#ac">点击查看详细</a>'):e.count>10?t("#all-"+n).html("后面还有"+(e.count-10)+'条评论<a href="/joke/'+n+'?all#ac">点击查看详细</a> | <a class="btn-hide" href="#'+n+'" data="ch">收起评论</a>'):t("#all-"+n).html("共有"+e.count+'条评论<a href="/joke/'+n+'#ac">点击查看详细</a> | <a class="btn-hide" href="#'+n+'">收起评论</a>'));if(e.count>0){e.comments.length<3?c=e.comments.length:c=t("#comment-container-"+n).attr("urlFrom")==="hao123"?3:e.comments.length;for(var E=0;E<c;E++){g=E+1,m=e.comments[E].splice(1,e.comments[E].length).reverse(),v=e.comments[E][0];for(var b in v)v[b]===null&&(v[b]="");h=v.user_name.substr(0,20),p=v.content.replace(new RegExp("&lt;br /&gt;","g"),"<br />"),f+='<div class="item clearfix" id="comment-item-'+v.id+'">'+'<a class="fl avatar32" name="n'+g+'" href="/user/'+v.user_id+'">'+'<img src="'+v.user_pic+'" width="32" height="32" />'+"</a>"+"<dl>"+'<dt class="clearfix">'+'<a class="highlight fl" href="/user/'+v.user_id+'">'+h+"</a>"+'<span class="fl pl-10">'+v.time+"发布</span> ",t("#comment-container-"+n).attr("urlFrom")===undefined&&(f+='<span class="fr"><a href="###" class="btn-replay" data="'+v.user_name+"&"+v.id+"&"+v.user_id+'">回复</a> |'+' <a href="###" class="btn-report" data="'+v.id+'">举报</a>',l===v.user_id?f+=' | <a href="###" class="btn-del" data="'+v.id+'">删除</a></span>':f+="</span>"),f+='</dt><dd class="word-wrap">'+w(m,n)+i.getFaceUrl(p)+"</dd>"+'<dd class="align-right">',v["able"]==1?f+='<a href="###" class="btn-icon light inline-block" data="'+v.id+"&"+v.user_id+'">'+v.light+"</a>":v["able"]==0&&(f+='<a href="###" class="btn-icon light inline-block light-disabled">'+v.light+"</a>"),f+="</dd></dl></div>"}}else f="<div class='comemt-no'>还没有人评论过哦，快来发表评论抢个沙发吧！</div>";if(t("#comments-"+n).length!==1)return;t("#tab-"+n).length===0?(t("#comment-container-"+n).attr("urlFrom")==="hao123"?y='<ul class="tab clearfix" id="tab-'+n+'">':y='<ul class="tab clearfix mt-15" id="tab-'+n+'">',o==="light"?y+='<li order="time"><a href="###">时间排序</a></li><li order="light" class="current"><a href="###">最亮排序</a></li>':y+='<li order="time" class="current"><a href="###">时间排序</a></li><li order="light"><a href="###">最亮排序</a></li>',y+="</ul>",t("#comments-"+n).before(y).html(f)):t("#comments-"+n).html(f),d().r==="joke"&&u!==""&&(window.location.hash="#n"+u,r.set("commentGoLocation","",365)),a.changeOrder(n,s),T(e,n,s,o),x(n)}}function S(e){t("#lwords-"+e).html("400"),t("#comment-input-"+e).val(""),t("#comment-input-"+e).blur()}function x(e){t("#comment-container-"+e).attr("urlFrom")===undefined&&(t(".quote").bind("mouseover",function(e){t(t(this).children(".quote-btn-container")[0]).css({visibility:"visible"}),e.stopPropagation()}),t(".quote").bind("mouseout",function(e){t(t(this).children(".quote-btn-container")[0]).css({visibility:"hidden"}),e.stopPropagation()}),t(".btn-replay").bind("click",function(){var n=t(this).attr("data").split("&");return a.reply(e,n[0],n[1],n[2]),!1}),t(".btn-report").bind("click",function(){return a.report(t(this).attr("data")),!1}),t(".btn-del").bind("click",function(){return a.del(t(this).attr("data"),e),!1}),t(".btn-hide").bind("click",function(){return t("#comment-container-"+e).remove(),!1})),t(".light").bind("click",function(){var n="";return t(this).hasClass("light-disabled")?!1:(n=t(this).attr("data").split("&"),u(t(this),e,n[0],n[1]),!1)})}function T(e,n,r,i){if(typeof e=="object")if(e.count>0){var s=[],o=10,u=parseInt(e.count/o);e.count%o>0&&u++;if(u>0){r>1?s.push('<a href="/joke/'+n+'#ac" data="'+(parseInt(r)-1)+'" class="pagination-last">上一页</a> '):s.push('<a href="javascript:;" class="pagination-last disabled">上一页</a> ');if(u<6)for(var f=1;f<=u;f++)r==f?s.push('<a href="javascript:;" class="current">'+f+"</a> "):s.push('<a href="/joke/'+n+'#ac" data="'+f+'">'+f+"</a> ");else if(r<4){for(var f=1;f<=5;f++)r==f?s.push('<a href="javascript:;" class="current">'+f+"</a> "):s.push('<a href="/joke/'+n+'#ac" data="'+f+'">'+f+"</a> ");s.push('...<a href="/joke/'+n+'#ac" data="'+u+'">'+u+"</a> ")}else if(u-3<r){s.push('<a href="/joke/'+n+'#ac">'+1+"</a>...");for(var f=u-4;f<=u;f++)r==f?s.push('<a href="javascript:;"  class="current">'+f+"</a> "):s.push('<a href="/joke/'+n+'#ac"  data="'+f+'">'+f+"</a> ")}else if(3<r<u-2){s.push('<a href="/joke/'+n+'#ac">'+1+"</a>...");for(var f=parseInt(r)-2;f<=parseInt(r)+2;f++)r==f?s.push('<a href="javascript:;"  class="current">'+f+"</a> "):s.push('<a href="/joke/'+n+'#ac"  data="'+f+'">'+f+"</a> ");s.push('...<a href="/joke/'+n+'#ac" data="'+u+'">'+u+"</a> ")}r<u?s.push('<a href="/joke/'+n+'#ac" data="'+(parseInt(r)+1)+'" class="pagination-next">下一页</a>'):s.push('<a href="javascript:;"  class="pagination-next disabled">下一页</a>'),s.push('<span class="paging-jump">跳转到<input name="num" type="text" class="number" id="jumpNum" value=""/><a href="/joke/'+n+'#ac"'+'id="btnGo" class="highlight btn-go">GO</a></span>')}t("#pagination-"+n).html(s.join(""))}else t("#pagination-"+n).html("");t("#pagination-"+n).find("a[data]").bind("click",function(){a.get(n,t(this).attr("data"),i)}),t("#btnGo").bind("click",function(){a.goToPage(u,r,n,i)}),t("#jumpNum").bind("keydown",function(e){e.keyCode===13&&a.goToPage(u,r,n,i)})}var t=e("jquery"),n=e("lib"),r=e("cookie"),i=e("./face"),s=e("./login"),o=e("./dialog"),u=e("./light"),a={},f="",l="",c=!1,h="文明上网，理性发言。请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。";window.mainHeight=0;var p={"CMT-SEND-BTN":"发送评论","CMT-SENDING-BTN":"发 送 中","CMT-SEND-ERROR":"提交评论失败，请稍后再试!","CMT-SEND-SENDING":"正在发送评论，请稍后!","CMT-SEND-KEYWORD":"文字中包含不当内容，请重新输入！","CMT-SEND-SUCCESS":"提交评论成功!","CMT-SEND-SAME":"您刚提交了一条相同评论，请不要重复提交！","CMT-SEND-TOOMANY":"您输入的评论内容段落数不能超过<b> 15 </b>个段落，请调整后再提交！","CMT-SEND-EMPTY":"评论内容不能为空，请填写内容！","CMT-DATA-ERROR":"服务器数据获取失败，无法更新评论！","CMT-TIP-LOGIN":"请您登录之后进行评论！","CMT-TIP-INTERVAL":"您讲得太快啦~休息，休息一下~","CMT-TIP-BAN":"您的账号已被屏蔽，暂时不能发布"};return t("#nickname").length===1&&(l=t("#nickname").attr("data")),a={checkHref:d,get:function(e,n,r,i){t.ajax({type:"GET",url:"/front_api.php?r=get_comments",data:{jid:e,page:n,offset:10,order:r},cache:!1,dataType:"json",beforeSend:function(){t("#comments-"+e).html('<div class="comemt-fail">评论正在加载中请稍候...</div>')},error:function(n){t("#comments-"+e).html('<div class="comemt-fail">读取评论列表失败</div>')},success:function(t){E(t,e,n,r,i)}})},reply:function(e,n,r,i){return t.ajax({type:"GET",url:"/front_api.php?r=login",dataType:"json",cache:!1,error:function(e){o.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"})},success:function(t){g(t,n,e,r,i)}}),!1},report:function(e){return t.ajax({type:"GET",url:"/front_api.php?r=insert_comment_report",dataType:"json",data:{cid:e},cache:!1,error:function(e){o.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"})},success:function(e){o.init({type:"alert",text:"提交成功，多谢您的反馈"})}}),!1},cancelReply:function(e){return t("#replay-"+e).animate({opacity:0,top:"-5px"},200,function(){t(this).html("")}),t("#comment-input-"+e).trigger("keyup").focus(),t("#send-"+e).attr("rid","0"),t("#send-"+e).attr("ruid","0"),t("#send-"+e).attr("reply",""),!1},insert:function(e,r){var i=y(e),s="",o="",u="";i&&(n.showMsg(e,p["CMT-SEND-SENDING"],{className:"comment-msg"}),c=!1,s=t("#send-"+e).attr("rid"),o=t("#send-"+e).attr("ruid"),u=t("#send-"+e).attr("reply"),s===undefined&&o===undefined?v({jid:e,rid:0,juid:r,ruid:0}):u!==undefined||u!==""?v({jid:e,rid:s,juid:r,ruid:o,replyStr:u}):v({jid:e,rid:s,juid:r,ruid:o}))},getCurPosL:function(e){var t=0;if(/msie/gi.test(window.navigator.userAgent)){e.focus();var n=null;n=document.selection.createRange();var r=n.duplicate();r.moveToElementText(e),r.setEndPoint("EndToEnd",n),e.selectionStart=r.text.length-n.text.length,e.selectionEnd=e.selectionStart+n.text.length,t=e.selectionStart}else if(e.selectionStart||e.selectionStart=="0")t=e.selectionStart;return t},checkInputNum:function(e,n){var r=t("#comment-input-"+n).val(),i=parseInt(r.length),s=i>400;e.keyCode===17&&(c=!1),s?t("#comment-input-"+n).val(r.substr(0,400)):null,t("#lwords-"+n).html(400-i)},shortcutSubmit:function(e,n){e.keyCode===17&&(c=!0),e.keyCode===13&&c==1&&(t("#comment-input-"+n).blur(),a.insert(n,t("#send-"+n).attr("juid")))},del:function(e,n){t.ajax({type:"GET",url:"/front_api.php?r=del_comment",data:{cid:e},dataType:"json",cache:!1,beforeSend:function(e){location.href.indexOf("haha.mx/my/comment/send")>0&&o.init({type:"msg",text:"<img src='http://static.haha.mx/images/ajax-loader.gif' style='vertical-align:middle; margin:0 6px 0 0'/>正在删除评论"})},success:function(e){var t="";if(e===1)location.href.indexOf("haha.mx/my/comment/send")>0?location.reload():(t=a.getOrder(n),a.get(n,1,t));else if(e===0)o.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"});else if(e===2)return s({type:"login",callback:"logined"}),!1},complete:function(){location.href.indexOf("haha.mx/my/comment/send")>0&&o.close()}})},goToPage:function(e,n,r,i){var s=t("#jumpNum").attr("value");s>0?s<=e?(n=s,a.get(r,n,i)):(n=e,a.get(r,n,i)):(n=1,a.get(r,n,i))},getOrder:function(e){var n=t("#tab-"+e).find("li.current");return n.attr("order")},changeOrder:function(e,r){var i=t("#tab-"+e).find("li");t.each(i,function(){t(this).bind("click",function(){var s=t(this).attr("order");if(t(this).hasClass("current"))return!1;i.removeClass(),t(this).addClass("current"),a.get(e,r,s),s==="light"&&n.statistics({m:d().r,n:"hotDiscuss",dt:"ui",data:{ux:"click"}})})})}},a}),define("app/imgready",["require","jquery"],function(e){var t=e("jquery");return function(e,t,n,r){var i={},s=0,o=0,u=0,a=0,f=new Image;f.src=e;if(f.complete)return t.call(f),n&&n.call(f),!1;s=f.width,o=f.height,i=function(){u=f.width,a=f.height;if(u!==s||a!==o||u*a>1024)t.call(f),i.end=!0},i(),f.onload=function(){i.end||i(),n&&n.call(f),f=f.onload=f.onerror=null},f.onerror=function(){r&&r&&r.call(f),i.end=!0,f=f.onload=f.onerror=null}}}),define("app/pic",["jquery","lib","./imgready"],function(e,t,n){function r(r){var r=r||{},a=r.j,f=r.o,l=f.attr("path"),c=f.attr("pic_name"),h="http://image.haha.mx/"+l+"big/"+c,p="http://image.haha.mx/"+l+"middle/"+c;o(f,a),n(p,function(){f.hide(),t.$("pic-box-"+a)===null?f.after(e('<div class="pic-box" id="pic-box-'+a+'">'+'<a href="'+h+'" id="btn-view-'+a+'" class="btn-original" target="_blank">查看原图</a><div class="clear"></div>'+'<a href="###" class="view-default-img" id="view-default-'+a+'">'+'<img src="'+p+'" id="big-'+a+'"/></a>'+"</div>")):e("#pic-box-"+a).show(),s(a,this.width,this.height),e("#view-default-"+a).bind("click",function(){i(a)})},function(){u(a)},function(){this.src="http://static.haha.mx/images/img-error.jpg",e("#btn-view-"+a).hide()})}function i(t){var n=e("#pic-box-"+t).parent().offset().top;e("#thumbnail-"+t).show(),e("#pic-box-"+t).hide(),e(window).scrollTop(n)}function s(t,n,r){n>90?e("#pic-box-"+t).css({width:n+6+"px"}):e("#pic-box-"+t).css({width:"90px"})}function o(t,n){e("#load-"+n).length===0&&t.append(e('<span id="load-'+n+'" class="pic-loading"></span>'))}function u(t){e("#load-"+t).remove()}return{view:r,showSmallPic:i,auto:s}}),define("app/single",["require","jquery","lib","./login","./comment","./face","./dialog","cookie"],function(e){function f(e){var t="";s.checkHref().f==="hao123"?t='<div class="comments" id="comments-'+e+'"></div>'+'<p class="align-right mt-10" id="all-'+e+'"></p>':t='<div class="bar align-center" id="login-box-'+e+'"></div>'+'<div class="comment-msg" id="msg-'+e+'"></div>'+'<div class="comments" id="comments-'+e+'"></div>'+'<div class="pagination mt-15" id="pagination-'+e+'"></div>',n("#comment-container-"+e).prepend(n(t))}function l(e,r,u){e===1||e===2?(n("#login-box-"+r).html(n('<div class="comment-input-box"><textarea name="comment-input" cols="" rows="" range="0" class="comment-input" id="comment-input-'+r+'"></textarea></div>'+'<ul class="clearfix">'+'<li class="fl">'+'<a href="###" id="add-face-'+r+'" class="inline-block add-face">表情</a>'+'<span class="word-check">您还可以输入<strong class="h1" id="lwords-'+r+'">400</strong>个字符</span>'+"</li>"+'<li class="fr">'+'<span class="shortcut">Ctrl+Enter快速提交</span>'+'<a href="###" juid="'+u+'" class="btn-primary send inline-block" id="send-'+r+'">发表评论</a>'+"</li>"+"</ul>")),n("#login-box-"+r).addClass("align-center"),n("#comment-input-"+r).bind("keyup",function(e){s.checkInputNum(e,r)}),n("#comment-input-"+r).bind("focus click keyup",function(){n(this).attr("range",s.getCurPosL(n("#comment-input-"+r)[0]))}),n("#comment-input-"+r).bind("keydown",function(e){s.shortcutSubmit(e,r)}),n("#send-"+r).bind("click",function(){if(n(this).hasClass("btn-disabled"))return!1;s.insert(r,u),n("#comment-input-"+r).blur()}),n("#add-face-"+r).bind("click",function(){return o.open(n(this),n("#comment-input-"+r)),!1})):e===0&&(n("#login-box-"+r).html('<div class="comment-input-box"><textarea name="comment-input" class="comment-input" cols="" rows="" readonly="readonly"> '+t+" </textarea></div>"+'<ul class="clearfix">'+'<li class="fl">'+'<a href="###" id="login-in-comment" class="highlight">立即登录</a>'+"<span>(登录后才能发表评论)</span>"+"</li>"+'<li class="fr">'+'<a href="###" class="btn-disabled send inline-block">发表评论</a>'+"</li>"+"</ul>"),n("#login-in-comment").bind("click",function(){return i({element:n(this),type:"login",callback:"logined"}),!1}),n(".comment-input").css({color:"#b5b5b5"}))}function c(e){n(".main").height(e)}var t="文明上网，理性发言。请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。",n=e("jquery"),r=e("lib"),i=e("./login"),s=e("./comment"),o=e("./face"),u=e("./dialog"),a=e("cookie");return function(e,t){var r=a.get("commentGoLocation").split("N")[0].replace("P",""),i=a.get("commentGoLocation").split("N")[1];f(e),r!==undefined&&i!==undefined?(r=r<1?1:r,s.get(e,r,"time",i)):s.checkHref().f==="all"?s.get(e,2,"time"):s.checkHref().f==="hao123"?s.get(e,1,"light"):s.get(e,1,"time"),n("#login-box-"+e).length===1&&n.ajax({type:"GET",url:"/front_api.php?r=login",dataType:"json",cache:!1,error:function(e){u.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"})},success:function(n){l(n,e,t)}}),n("#data-loading").remove()}}),define("app/reply",["require","jquery","./login","./comment","./single","./face"],function(e){function u(e,t,r,s,u){n(".comment-user-page").remove();if(n("#comment-input-area-"+r).length!==0)return!1;n("#comment-item-"+r).append(n('<div class="comment-user-page"><div class="bar align-center" id="login-box-'+e+'">'+'<div class="comment-input-box"><textarea name="comment-input" '+'cols="" rows="" range="0" class="comment-input" id="comment-input-'+e+'"></textarea></div>'+'<ul class="clearfix">'+'<li class="fl">'+'<a href="###" id="add-face-'+e+'" class="inline-block add-face">表情</a>'+'<span class="word-check">您还可以输入<strong class="h1" id="lwords-'+e+'">400</strong>个字符</span>'+"</li>"+'<li class="fr">'+'<span class="shortcut">Ctrl+Enter快速提交</span>'+'<a href="###" juid="'+u+'" class="btn-primary send inline-block" id="send-'+e+'">发表评论</a>'+"</li>"+"</ul>"+"</div>"+'<div class="comment-msg" id="msg-'+e+'"><div><div>')),i.reply(e,t,r,s),n("#comment-input-"+e).focus(),n("#login-box-"+e).addClass("align-center"),n("#comment-input-"+e).bind("keyup",function(t){i.checkInputNum(t,e)}),n("#comment-input-"+e).bind("focus click keyup",function(){n(this).attr("range",i.getCurPosL(n("#comment-input-"+e)[0]))}),n("#comment-input-"+e).bind("keydown",function(t){i.shortcutSubmit(t,e)}),n("#send-"+e).bind("click",function(){if(n(this).hasClass("btn-disabled"))return!1;i.insert(e,n(this).attr("juid")),n("#comment-input-"+e).blur()}),n("#add-face-"+e).bind("click",function(){return o.open(n(this),n("#comment-input-"+e)),!1})}var t="文明上网，理性发言。请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。",n=e("jquery"),r=e("./login"),i=e("./comment"),s=e("./single"),o=e("./face");return function(e,t,n,r,i){var s=arguments[0];if(typeof s=="object")var e=s[0],t=s[1],n=s[2],r=s[3],i=s[4];u(e,t,n,r,i)}}),define("app/bindhotcomment",["require","jquery","./pic","./light","./comment","./reply"],function(e){function o(e){var o=e.attr("cid"),u=e.attr("jid"),a=e.attr("juid"),f="",l="",c="",h="";e.find("a[data]").each(function(e,p){f=t(p).attr("data");if(f==="")return!1;if(f.indexOf("|")<0)switch(f){case"cp":t(p).bind("click",function(){return n.view({o:t(p),j:o}),!1});break;case"cl":t(p).bind("click",function(){return r(t(p),u,o,a),!1});break;case"cd":t(p).on("click",function(){i.del(o,u)});break;default:return!1}else{l=f.split("|")[0],c=f.split("|")[1],c.indexOf("&")>0?h=c.split("&"):h=c;switch(l){case"cr":t(p).on("click",function(){s(h)});break;default:return!1}}})}var t=e("jquery"),n=e("./pic"),r=e("./light"),i=e("./comment"),s=e("./reply");return function(){t(".comment-item").each(function(e,n){o(t(n))})}}),define("app/vote",["require","jquery"],function(e){var t=e("jquery"),n={},r=null;return function(e,i,s,o){n={jid:i,v:s,uid:e},r=t.ajax({type:"GET",url:"/front_api.php?r=vote",dataType:"json",data:n,cache:!1,beforeSend:function(){o!==""&&t("#"+o+"-"+i).addClass(o+"-disabled").unbind("click"),t("#"+s+"-"+i).addClass(s+"-disabled")}}),r.done(function(e){if(e===1){var n=parseInt(t("#"+s+"-"+i).html());t("#"+s+"-"+i).html(n+1)}})}}),define("app/list",["require","jquery","cookie","./login","./comment","./face"],function(e){function u(e){var n=t('<div class="comment-container" id="comment-container-'+e+'">'+'<div class="bar mt-15'+o+'" id="login-box-'+e+'"></div>'+'<div class="comment-msg" id="msg-'+e+'"></div>'+'<div class="comments" id="comments-'+e+'"></div>'+'<p class="align-right mt-10" id="all-'+e+'"></p>'+0/0);t("#joke-"+e).append(n)}function a(e,o,u){e===1||e===2?(t("#login-box-"+o).html(t('<div class="comment-input-box"><textarea name="comment-input" cols="" rows="" range="0" class="comment-input" id="comment-input-'+o+'"></textarea></div>'+'<ul class="clearfix">'+'<li class="fl">'+'<a href="###" id="add-face-'+o+'" class="inline-block add-face">表情</a>'+'<span class="word-check">您还可以输入<strong class="h1" id="lwords-'+o+'">400</strong>个字符</span>'+"</li>"+'<li class="fr">'+'<span class="shortcut">Ctrl+Enter快速提交</span>'+'<a href="###" juid="'+u+'" class="btn-primary send inline-block" id="send-'+o+'">发表评论</a>'+"</li>"+"</ul>")),t("#comment-input-"+o).focus(),t("#login-box-"+o).addClass("align-center"),t("#comment-input-"+o).bind("keyup",function(e){i.checkInputNum(e,o)}),t("#comment-input-"+o).bind("focus click keyup",function(){t(this).attr("range",i.getCurPosL(t("#comment-input-"+o)[0]))}),t("#comment-input-"+o).bind("keydown",function(e){i.shortcutSubmit(e,o)}),t("#send-"+o).bind("click",function(){if(t(this).hasClass("btn-disabled"))return!1;i.insert(o,t(this).attr("juid")),t("#comment-input-"+o).blur()}),t("#add-face-"+o).bind("click",function(){return s.open(t(this),t("#comment-input-"+o)),!1})):e==0&&(t("#login-box-"+o).html('您尚未登录，暂时无法发表评论。<a href="javascript:;" id="itemComment-'+o+'" class="highlight">立即登录</a>'),t("#login-box-"+o).css({padding:"0 10px"}),t("#itemComment-"+o).bind("click",function(){r({element:"itemComment-"+o,type:"login",callback:"logined"}),n.set("jid",o,1),n.set("juid",u,1)}))}function f(e){t("#comment-container-"+e).remove()}var t=e("jquery"),n=e("cookie"),r=e("./login"),i=e("./comment"),s=e("./face"),o=i.checkHref().f==="hao123"?" mb-15":"";return function(e,n,r){t("#comment-container-"+n).length===0?(u(n),i.get(n,1,"time"),t.ajax({type:"GET",url:"/front_api.php?r=login",dataType:"json",cache:!1,error:function(e){},success:function(e){a(e,n,r)}}),e.attr("title","收起评论")):(f(n),e.attr("title","展开评论"))}}),define("app/fav",["require","jquery","./login","./dialog"],function(e){function i(e){var n=e.j,i=e.o,o=t.ajax({url:"/front_api.php?r=add_favorite",type:"GET",data:{joke_id:n},dataType:"json",cache:!1});o.done(function(e){s(e,i,n)}),o.fail(function(e,t){r.init({type:"alert",text:"收藏失败，请稍后再试"})})}function s(e,t,i){e===1||e===-2?t.addClass("fav-disabled").attr({data:"f|1",title:"取消收藏"}).unbind("click").bind("click",function(e){o({j:i,o:t})}):e===0?n({element:t,type:"login",callback:"logined"}):e===-1?r.init({type:"alert",text:"悲了个剧的，收藏已达到上限"}):e===-3&&r.init({type:"alert",text:"收藏失败，请稍后再试"})}function o(e){var n=e.j,i=e.o,s=t.ajax({url:"/front_api.php?r=del_favorite",type:"GET",data:{fid:n},dataType:"json",cache:!1});s.done(function(e){u(e,i,n)}),s.fail(function(e,t){r.init({type:"alert",text:"取消收藏失败，请稍后再试"})})}function u(e,t,s){e===1?window.location.href.indexOf("haha.mx/my/fav")>0?window.location.reload():t.removeClass("fav-disabled").attr({data:"f|0",title:"收藏"}).unbind("click").bind("click",function(){i({j:s,o:t})}):e===0?n({element:t,type:"login",callback:"logined"}):e===-1&&r.init({type:"alert",text:"取消收藏失败，请稍后再试"})}var t=e("jquery"),n=e("./login"),r=e("./dialog");return{add:i,cancel:o}}),define("app/share",["jquery","lib"],function(e,t){function i(){o()}function s(t){var t=t||{},n=t.o,r=t.j,i=document.title+"："+n.attr("text").replace(/<.*?>/g,""),s="http://www.haha.mx/joke/"+r;e("#shareLayer").length===0?(e("body").append(e('<div class="share-layer" id="shareLayer"></div>')),e("#shareLayer").html('<dl class="item-share"><dt>分享到:</dt><dd><a class="btn-share-sina" site="sina" title="转帖到新浪微博" href="###"></a></dd><dd><a class="btn-share-qq" site="qq" title="转帖到QQ空间" href="###"></a></dd><dd><a class="btn-share-rr" site="rr" title="转帖到人人网" href="###"></a></dd><dd><a class="btn-share-kx" site="kx" title="转帖到开心网" href="###"></a></dd><dd><a class="btn-share-db" site="db" title="推荐到豆瓣" href="###"></a></dd><dd><a class="btn-share-tqq" site="tqq" title="推荐到QQ微博" href="###"></a></dd></dl>'),e("#shareLayer").css({left:n.offset().left+"px",top:n.offset().top+14+"px"}),u({type:"shareLayer",jid:r})):e("#shareLayer").css({left:n.offset().left+"px",top:n.offset().top+14+"px",display:"block"}),e("#shareLayer").is(":visible"),n.bind("mouseout",function(){e("#shareLayer").hide()}),e("#shareLayer").bind("mouseout",function(){e(this).hide()}),e("#shareLayer").bind("mouseover",function(){e(this).show()})}function o(){}function u(t){var n=t.jid,i=t.type,s=e("#"+i).find("dd a"),o="";e.each(s,function(){e(this).bind("click",function(){o=e(this).attr("site");switch(o){case"rr":a({jid:n,url:r.rr,type:"rr"});break;case"tqq":a({jid:n,url:r.tqq,type:"tqq"});break;case"kx":a({jid:n,url:r.kx,type:"kx"});break;case"db":a({jid:n,url:r.db,type:"db"});break;case"qq":a({jid:n,url:r.qq,type:"qq"});break;case"sina":a({jid:n,url:r.sina,type:"sina"})}})})}function a(t){var r=t.jid,i="",s="http://www.haha.mx/joke/"+r,o="",u=0,a="",f="",l={},c=[];e("#joke-"+r).find(".text").html()===null?i=document.title:i=document.title+"："+e("#joke-"+r).find(".text").html().replace(/<.*?>/g,""),n.$("list-pic-"+r)?(u=e("#list-pic-"+r).find("img:first").attr("src").indexOf("http://static.haha.mx/images/img-error.jpg"),u<0?(a=e("#list-pic-"+r).attr("path"),f=e("#list-pic-"+r).attr("pic_name"),o="http://image.haha.mx/"+a+"big/"+f):o=""):o="";switch(t.type){case"qq":l={url:s,desc:i.substring(0,150),summary:"笑话分享站",title:i.substring(0,150),site:"http://www.haha.mx/",pics:o};break;case"sina":l={url:s,type:"3",count:"",appkey:"",title:i.substring(0,150),pic:o,ralateUid:"",rnd:(new Date).valueOf()};break;case"rr":l={link:s,title:i.substring(0,150)};break;case"tqq":l={appkey:"",site:"http://www.haha.mx/",pic:o,title:i.substring(0,150),url:s};break;case"kx":l={rurl:s,rtitle:i.substring(0,150),rcontent:""};break;case"db":l={url:s,title:i.substring(0,150),sel:"",v:1}}for(var h in l)c.push(h+"="+encodeURIComponent(l[h]||""));window.open(t.url+c.join("&"),"_blank","")}var n=t,r={rr:"http://share.renren.com/share/buttonshare.do?",qq:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",tqq:"http://v.t.qq.com/share/share.php?",kx:"http://www.kaixin001.com/repaste/bshare.php?",sina:"http://service.weibo.com/share/share.php?",db:"http://www.douban.com/recommend/?"};return{layer:s,fn:a}}),define("app/joke-report",["require","jquery","lib","./login","./dialog"],function(e){function u(e){var r=1;e.bind("change",function(){r=t('input:radio[checked="checked"]').attr("id").split("-")[2],r==4?(t("#input-box-report").show(),i.position(600,330),n.initInput(t("#reporttextArea"),"请举报相应信息","iuput-box-text"),s=!0):(i.position(600,185),t("#input-box-report").hide(),t("#dialog-reporttip").html(""),s=!1),o.type=r})}function a(e,n){var r="",i=0;o.jid=e,o.type=n;if(s){r=t.trim(t("#reporttextArea").val()),i=r.length;if(r==="请举报相应信息"||r==="")return t("#dialog-reporttip").html("请您输入举报内容"),!1;if(i>400)return t("#dialog-reporttip").html("您的举报太长了~请精简在400字以内"),!1;o.content=encodeURI(r)}else o.content="";f(o,e)}function f(e,n){t.ajax({type:"GET",url:"/front_api.php?r=insert_report",dataType:"json",cache:!1,data:e,error:function(n){i.init({type:"alert",text:"提交成功，多谢您的反馈"}),e={},s=t("#input-box-report").is(":visible")},success:function(n){i.init({type:"alert",text:"提交成功，多谢您的反馈"}),e={},s=t("#input-box-report").is(":visible")}})}function l(e){t(".dialog-report").find(".submit").bind("click",function(){if(o.type==""||o.type==undefined)o.type=1;o.jid=e,a(e,o.type)})}var t=e("jquery"),n=e("lib"),r=e("./login"),i=e("./dialog"),s=t("#input-box-report").is(":visible"),o={};return function(e){i.init("report"),u(t('input:radio[name="report-style"]')),l(e)}}),define("app/joke-del",["require","jquery","./login","./dialog"],function(e){function i(e){e==1?location.reload():e==0?r.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"}):e==2&&(n({element:"del_joke",type:"login",callback:"logined"}),t("#login #loginTip").html("请先登录傲游账户"))}var t=e("jquery"),n=e("./login"),r=e("./dialog");return function(e){t.ajax({type:"GET",url:"/front_api.php?r=del_joke",dataType:"json",data:{jid:e},cache:!1,error:function(e){r.init({type:"alert",text:"由于网络问题未提交成功，请稍后重试！</br>如有问题请和管理员联系：haha@maxthon.net。"})},success:function(e){i(e)}})}}),define("app/video-list",["jquery"],function(e){return function(e,t,n,r){var i="",s=t===""?e.length:4;for(var o=0;o<s;o++)r==="sidebar"?(o%2===1?i+='<a href="/joke/'+e[o].url+'" target="_blank" class="'+r+'-poll-item fr">':o%2===0&&(i+='<a href="/joke/'+e[o].url+'" target="_blank" class="'+r+'-poll-item fl">'),i+='<span class="video-cover"></span><span class="video-cover-layer"></span><span class="img-container"><img src="'+e[o].poster+'" title="'+e[o].title+'"/></span>'+"<span>"+e[o].title.substr(0,8)+"</span>"+"</a>"):r==="rank"?(i+='<a href="/'+e[o].url+'" target="_blank" class="'+r+'-poll-item">',i+='<img src="'+e[o].poster+'" title="'+e[o].title+'"/></a>'):i+='<a href="/joke/'+e[o].url+'" target="_blank" class="'+r+'-poll-item">'+'<span class="video-cover"></span><span class="video-cover-layer"></span><span class="img-container"><img src="'+e[o].poster+'" title="'+e[o].title+'"/></span>'+"<span>"+e[o].title.substr(0,8)+"</span>"+"</a>";n.html(i)}}),define("app/poll",["jquery","lib","./video-list","http://www.haha.mx/upload/data/video.json?callback=define"],function(e,t,n,r){function o(){var i=[],o="";t.checkHref().r==="rank"?(i=s.list,o="rank"):(i=r.list,o="joke"),n(i,"",e("#labels-polling-img"),o)}var s={type:"image",list:[{title:"哈由心生",url:"activity/7",poster:"http://static.haha.mx/images/activity/ac7.png"},{title:"寂寞PK",url:"activity/1",poster:"http://static.haha.mx/images/activity/ac1.png"},{title:"最萌",url:"activity/2",poster:"http://static.haha.mx/images/activity/ac2.png"},{title:"晒幸福",url:"activity/3",poster:"http://static.haha.mx/images/activity/ac3.png"},{title:"万圣节",url:"activity/5",poster:"http://static.haha.mx/images/activity/ac2.png"}]};return function(t,n){o();if(!t)var t={};var r=t.obj,u=t.left,a=t.right,f=r.find("#labels-polling-img"),l=f.find("a:first").width(),c=t.row?parseInt(t.row):parseInt(f.width()/l),h=f.find("a").length/c,p=f.find("a").length%c===0?h:Math.round(h)+1,h=1,d=function(){var t=parseInt(f.attr("currentScreen")?f.attr("currentScreen"):1);e(".label-nav-next > a").hasClass("next-label-disabled")&&e(".label-nav-next > a").removeClass().addClass("next-label");if(t===1)return!1;for(i=1;i<=c;i++)f.find("a:first").appendTo(f);f.attr("currentScreen",t-1),t===2?e(this).removeClass().addClass("last-label-disabled"):e(this).removeClass().addClass("last-label")},v=function(){var t=parseInt(f.attr("currentScreen")?f.attr("currentScreen"):1);e(".label-nav-last > a").hasClass("last-label-disabled")&&e(".label-nav-last > a").removeClass().addClass("last-label");if(t===p)return!1;for(i=1;i<=c;i++)f.find("a:last").show().prependTo(f);f.attr("currentScreen",t+1),t===p-1?e(this).removeClass().addClass("next-label-disabled"):e(this).removeClass().addClass("next-label")};s.length<c?(u.removeClass().addClass("last-label-disabled"),a.removeClass().addClass("next-label-disabled")):(u.click(d),a.click(v))}}),define("app/bindjoke",["require","jquery","cookie","./vote","./comment","./pic","./dialog","./list","./light","./fav","./share","./joke-report","./joke-del","lib","./poll"],function(e){function d(e){e.on({mouseenter:function(){t(this).find(".toolkit").add(t(this).find("#bdshare")).css({visibility:"visible"})},mouseleave:function(){t(this).find(".toolkit").add(t(this).find("#bdshare")).css({visibility:"hidden"})}})}function v(e,n,i){var a="",l="",d="",v="";e.find("a[data]").each(function(e,m){a=t(m).attr("data");if(a==="")return!1;if(a.indexOf("|")<0)switch(a){case"d":t(m).on("click",function(){return o.init({type:"prompt",text:"确定要删除此笑话吗？"}),t("#btn-confirm").on("click",function(){h(n)}),!1});break;case"r":t(m).on("click",function(){return c(n),!1});break;case"b":t(m).one("click",function(){return r(i,n,"bad","good"),p.statistics({n:"despise",dt:"ui",data:{ux:"click"}}),!1});break;case"g":t(m).one("click",function(){return r(i,n,"good","bad"),p.statistics({n:"praise",dt:"ui",data:{ux:"click"}}),!1});break;case"c":t(m).on("click",function(){return u(t(this),n,i),p.statistics({n:"discussbutton",dt:"ui",data:{ux:"click"}}),!1});break;case"cp":t(m).on("click",function(){return s.view({o:t(m),j:n}),!1});break;default:return!1}else{l=a.split("|")[0],d=a.split("|")[1],d.indexOf("&")>0?v=d.split("&"):v=d;switch(l){case"f":t(m).on("click",function(){return p.statistics({n:"favbutton",dt:"ui",data:{ux:"click"}}),v==="0"?(f.add({j:n,o:t(m)}),!1):v==="1"?(f.cancel({j:n,o:t(m)}),!1):!1});break;default:return!1}}})}var t=e("jquery"),n=e("cookie"),r=e("./vote"),i=e("./comment"),s=e("./pic"),o=e("./dialog"),u=e("./list"),a=e("./light"),f=e("./fav"),l=e("./share"),c=e("./joke-report"),h=e("./joke-del"),p=e("lib");return function(){t(".joke-item").each(function(e,n){var r=t(n).attr("jid"),s=t(n).attr("juid");v(t(n),r,s),i.checkHref().r==="joke"?i.checkHref().f==="hao123"&&e>0&&d(t(n)):d(t(n)),t(n).find("#bdshare > a").each(function(e,n){t(n).on("click",function(){var e=t(this).attr("class").replace(/^bds_/g,"");p.statistics({n:"share",o:e,dt:"ui",data:{ux:"click"}})})})}),n.get("jid")!==""&&n.get("juid")!==""&&(location.href="#"+n.get("jid"),u(t("#joke-"+n.get("jid")).find(".comment"),n.get("jid"),n.get("juid")),n.set("jid","",1),n.set("juid","",1)),t("#video-poll").length===1&&e("./poll")({obj:t("#labels-polling"),left:t("#labels-polling .label-nav-last > a"),right:t("#labels-polling .label-nav-next > a")})}}),define("app/score",["require"],function(e){function n(){var e="",t=0,n=[],r=[];for(var i=0;i<60;i++)e++,t=10*(e*e-1),n[i]=t;for(var s=0;s<3;s++)r[s]=n.slice(s*20,s*20+20);return r}function r(e){var t=n(),r="";for(var i=0;i<3;i++){var s=i*20+e+1;r+="<td>"+s+'<span class="icon-lv icon-'+s+' inline-block"></span></td><td>'+t[i][e]+"</td>"}return r}var t="";return function(){for(var e=0;e<20;e++)t+="<tr>"+r(e)+"</tr>";$("#grid").html(t)}}),define("app/requestlevel",["require","jquery"],function(e){var t=e("jquery"),n=null;return function(e,r){n=t.ajax({url:"/front_api.php?r=my_level",type:"GET",data:{uid:e},dataType:"json",cache:!1}),n.done(function(e){e!==0&&r(e)})}}),define("app/progressbar",["jquery","./requestlevel"],function(e,t){function r(t){var n=parseInt(t),r=12.4;e("#progress-area").show(),e("#middle").css({width:n*r+"px"}),e("#progress-current").find(".icon-lv").addClass("icon-"+n),e("#progress-current").css({left:n*r-42+"px"})}var n=e("#progress-box").attr("uid");return function(){t(n,r)}}),define("app/page-my",["require","jquery","./common","./comment","./bindhotcomment","./bindjoke","./score","./progressbar"],function(e){var t=e("jquery"),n=e("./common"),r=e("./comment"),i=e("./bindhotcomment"),s=e("./bindjoke"),o=e("./score"),u=e("./progressbar");if(location.href.indexOf("haha.mx/my/score")>0)o(),u();else if(location.href.indexOf("haha.mx/my/comment")>0)i();else{if(location.href.indexOf("haha.mx/my/message")>0)return!1;s()}});